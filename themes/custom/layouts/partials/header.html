<header class="header">
    <nav class="nav">
        <div class="logo">
            {{- $label_text := (site.Params.label.text | default site.Title) }}
            {{- if site.Title }}
            <a href="{{ "" | absLangURL }}" accesskey="h" title="{{ $label_text }} (Alt + H)">
                {{- if site.Params.label.icon }}
                {{- $img := resources.Get site.Params.label.icon }}
                {{- if $img }}
                    {{- $processableFormats := (slice "jpg" "jpeg" "png" "tif" "bmp" "gif") -}}
                    {{- if hugo.IsExtended -}}
                        {{- $processableFormats = $processableFormats | append "webp" -}}
                    {{- end -}}
                    {{- $prod := (hugo.IsProduction | or (eq site.Params.env "production")) }}
                    {{- if and (in $processableFormats $img.MediaType.SubType) (eq $prod true)}}
                        {{- if site.Params.label.iconHeight }}
                            {{- $img = $img.Resize (printf "x%d" site.Params.label.iconHeight) }}
                        {{ else }}
                            {{- $img = $img.Resize "x30" }}
                        {{- end }}
                    {{- end }}
                    <img src="{{ $img.Permalink }}" alt="" aria-label="logo"
                        height="{{- site.Params.label.iconHeight | default "30" -}}">
                {{- else }}
                <img src="{{- site.Params.label.icon | absURL -}}" alt="" aria-label="logo"
                    height="{{- site.Params.label.iconHeight | default "30" -}}">
                {{- end -}}
                {{- else if hasPrefix site.Params.label.iconSVG "<svg" }}
                    {{ site.Params.label.iconSVG | safeHTML }}
                {{- end -}}
                {{ partial "icon.html" (dict "name" "coding-apps-websites/coding-apps-websites-dinosaur-error" "class" "logo-name-icon" "size" 28 "ariaHidden" true) }}
                {{- $label_text -}}
            </a>
            {{- end }}
            <div class="logo-switches">
                {{- if (not site.Params.disableThemeToggle) }}
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    {{ partial "icon.html" (dict "name" "interface-essential/interface-essential-switch-off" "id" "moon" "size" 24 "ariaHidden" true) }}
                    {{ partial "icon.html" (dict "name" "interface-essential/interface-essential-switch-on" "id" "sun" "size" 24 "ariaHidden" true) }}
                </button>
                {{- end }}
                
                <button id="accessibility-toggle" accesskey="a" title="Paramètres d'accessibilité (Alt + A)" aria-label="Ouvrir les paramètres d'accessibilité" aria-expanded="false" aria-controls="accessibility-panel">
                    {{ partial "icon.html" (dict "name" "interface-essential/interface-essential-setting-cog" "size" 24 "ariaHidden" true) }}
                </button>
                
                {{- if (not site.Params.disableLangToggle) }}
                    {{- $lang := .Lang}}
                    {{- $separator := or $label_text (not site.Params.disableThemeToggle)}}
                    {{- with site.Home.Translations }}
                    <ul class="lang-switch">
                        {{- if $separator }}<li>|</li>{{ end }}
                        {{- range . -}}
                        {{- if ne $lang .Lang }}
                        <li>
                            <a href="{{- .Permalink -}}" title="{{ .Language.Params.languageAltTitle | default (.Language.LanguageName | emojify) | default (.Lang | title) }}"
                                aria-label="{{ .Language.LanguageName | default (.Lang | title) }}">
                                {{- if (and site.Params.displayFullLangName (.Language.LanguageName)) }}
                                {{- .Language.LanguageName | emojify -}}
                                {{- else }}
                                {{- .Lang | title -}}
                                {{- end -}}
                            </a>
                        </li>
                        {{- end -}}
                        {{- end}}
                    </ul>
                    {{- end }}
                {{- end }}
            </div>
            <button id="menu-toggle" class="menu-toggle" aria-label="Ouvrir le menu" aria-expanded="false" aria-controls="menu">
                {{ partial "icon.html" (dict "name" "interface-essential/interface-essential-navigation-menu-1" "size" 24 "ariaHidden" true) }}
                {{ partial "icon.html" (dict "name" "interface-essential/interface-essential-close-x" "class" "close-icon" "size" 24 "ariaHidden" true) }}
            </button>
        </div>
        {{- $currentPage := . }}
        {{- $pillarMapping := dict "le-role-du-cto" "le-role-du-cto" "gouvernance-decision" "gouvernance-decision" "culture-management" "culture-management" "trouver-sa-place" "trouver-sa-place" }}
        {{- $menuIcons := dict "start-here" "interface-essential/interface-essential-navigation-right-circle-1" "le-role-du-cto" "coding-apps-websites/coding-apps-websites-dinosaur-error" "gouvernance-decision" "business/business-product-scale" "culture-management" "users/multiple-user" "trouver-sa-place" "map-navigation/map-navigation-compass-direction" "guides-livres" "content-files/content-files-open-book" "about" "interface-essential/interface-essential-information-circle-1" }}
        <ul id="menu">
            {{- range site.Menus.main }}
            {{- $menu_item_url := (cond (strings.HasSuffix .URL "/") .URL (printf "%s/" .URL) ) | absLangURL }}
            {{- $page_url:= $currentPage.Permalink | absLangURL }}
            {{- $is_search := eq (site.GetPage .KeyName).Layout `search` }}
            {{- $pillarSlug := index $pillarMapping .Identifier }}
            {{- $menuIcon := index $menuIcons .Identifier }}
            <li>
                <a href="{{ .URL | absLangURL }}" 
                   title="{{ .Title | default .Name }} {{- cond $is_search (" (Alt + /)" | safeHTMLAttr) ("" | safeHTMLAttr ) }}"
                   {{- cond $is_search (" accesskey=/" | safeHTMLAttr) ("" | safeHTMLAttr ) }}
                   {{- if $pillarSlug }} data-pillar="{{ $pillarSlug }}"{{- end }}>
                    <span {{- if eq $menu_item_url $page_url }} class="active" {{- end }} style="display: flex; align-items: center; gap: 8px;">
                        {{- if $menuIcon }}
                        {{- partial "icon.html" (dict "name" $menuIcon "class" "menu-icon" "size" 20 "ariaHidden" true) }}
                        {{- end }}
                        {{- .Pre }}
                        {{- .Name -}}
                        {{ .Post -}}
                    </span>
                    {{- if (findRE "://" .URL) }}&nbsp;
                    {{ partial "icon.html" (dict "name" "interface-essential/interface-essential-hyperlink" "size" 12 "ariaHidden" true) }}
                    {{- end }}
                </a>
            </li>
            {{- end }}
        </ul>
    </nav>
</header>
